webpackJsonp([3],{GCPx:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("a3Yh"),a=n.n(r),o=(n("T452"),n("Gnkd")),i=(n("KC6+"),n("TIfe")),l=(n("dGkP"),n("6ROu")),c={data:function(){var e;return e={activeName:"first",community_list:[]},a()(e,"activeName",""),a()(e,"order_list",[]),e},components:{"sta-table":function(){return new Promise(function(e){e()}).then(n.bind(null,"dGkP"))}},created:function(){var e=this,t=Object(o.a)(),n=Object(i.a)()._id,r=l().format("YYYY-MM-DD HH:mm:ss"),a=l().month(),c=l().year(),s=l([c,a,1,0,0,0]).format("YYYY-MM-DD HH:mm:ss");console.log(s),console.log(r);var d={orderDate:{$gte:s,$lte:r}};t.subscribe("orders.all",n,d),t.ddp.on("added",function(t){t.collection;var n=t.id,r=t.fields;console.log("added"),e.order_list.includes(function(e){e.id})||(r.id=n,r.wechat=r.wechatUser.nickName,e.order_list.push(r))}),t.ddp.on("changed",function(t){t.collection;var n=t.id,r=t.fields,a=e.order_list.findIndex(function(e){return e.id==n});a>=0&&(r.id=n,e.order_list[a].deliver=!0)}),t.ddp.on("removed",function(t){t.collection;var n=t.id;e.order_list=e.order_list.filter(function(e){return e.id!==n})}),Object(o.b)(n).then(function(t){if(0===t.code){var n=t.list;e.community_list=n}})},methods:{handleClick:function(e,t){}}},s={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container tab-container"},[n("el-tabs",{staticStyle:{"margin-top":"15px"},attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.community_list,function(t){return n("el-tab-pane",{key:t._id,attrs:{label:t.community_name,name:t.community_name}},[n("keep-alive",[e.activeName==t.community_name?n("sta-table",{attrs:{communityid:t._id,orderList:e.order_list,community_name:t.community_name}}):e._e()],1)],1)}))],1)},staticRenderFns:[]},d=n("vSla")(c,s,!1,null,null,null);t.default=d.exports},Gnkd:function(e,t,n){"use strict";t.a=function(){return r.a.getAsteroid()},t.b=function(e){return r.a.getAsteroid().call("getCommunityList",e)},t.d=function(e,t){return r.a.getAsteroid().call("getOrderList",e,t)},t.e=function(e,t,n){return r.a.getAsteroid().call("getSoFarSales",e,t,n)},t.c=function(e,t,n){return r.a.getAsteroid().call("getItemStat",e,t,n)};var r=n("T452")},JhHb:function(e,t,n){n("SAFe");var r=n("AKd3").Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},SAFe:function(e,t,n){var r=n("FITv");r(r.S+r.F*!n("sjnA"),"Object",{defineProperty:n("lIiZ").f})},a3Yh:function(e,t,n){"use strict";t.__esModule=!0;var r,a=n("liLe"),o=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t,n){return t in e?(0,o.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},dGkP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("Gnkd"),a=n("TIfe"),o=n("6ROu"),i={props:["orderList","communityid","community_name"],watch:{orderList:function(e,t){var n=this;this.orders=e.filter(function(e){return e.community_id===n.communityid})}},created:function(){var e=this;this.cid=this.communityid,this.loading=!0,this.orders=this.orderList.filter(function(t){return t.community_id===e.communityid}),this.loading=!1},data:function(){return{cid:"",orders:[],loading:!1,autoWidth:!0,date_range:""}},filters:{statusFilter:function(e){return{true:"success",false:"danger"}[e]}},methods:{handleDownload:function(){var e=this;Promise.all([n.e(17),n.e(16)]).then(n.bind(null,"zWO4")).then(function(t){var n=e.orders,r=e.formatJson(["orderDate","community_name","item_title","name","wechat","phone","address","sale_price","num","morePrice"],n),a=e.community_name+"-"+o().format("YYYYMMDD");t.export_json_to_excel({header:["订单时间","社区名称","商品名称","客户","微信用户名","电话","地址","单价","订单量","销售额"],data:r,filename:a,autoWidth:e.autoWidth})})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return"sale_price"===e||"num"===e||"morePrice"===e?parseFloat(t[e]):t[e]})})},handleSearch:function(){var e=this,t={orderDate:{$gte:this.date_range[0]+" 00:00:00",$lte:this.date_range[1]+" 23:59:59"},community_id:this.cid},n=Object(a.a)()._id;Object(r.d)(n,t).then(function(t){var n=t.list;n.forEach(function(e){e.wechat=e.wechatUser.nickName}),e.orders=n})}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button",{staticStyle:{margin:"0 0 20px 20px"},attrs:{type:"primary",icon:"document"},on:{click:e.handleDownload}},[e._v("\n        "+e._s(e.$t("excel.export"))+" excel\n    ")]),e._v(" "),n("el-row",{staticClass:"filter-container",attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("div",{staticClass:"block"},[n("span",{staticClass:"demonstration"},[e._v("按日期检索")]),e._v(" "),n("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.date_range,callback:function(t){e.date_range=t},expression:"date_range"}})],1)]),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("检索")])],1)],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orders,stripe:"",border:"","max-height":"500"}},[n("el-table-column",{attrs:{fixed:"",prop:"orderDate",label:"订单时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.orderDate)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"community_name",label:"社区名称",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.community_name)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"item_title",label:"商品名称",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.item_title)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"客户",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.name)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"wechat",label:"微信用户名",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.wechat)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"phone",label:"电话",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.phone)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"address",label:"地址",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.address)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"sale_price",label:"单价",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.sale_price)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"num",label:"订单量",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.num)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"morePrice",label:"销售额",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.morePrice)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"pickMethod",label:"配送方式",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.pickMethod)+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",prop:"deliver",label:"订单状态",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:e._f("statusFilter")(t.row.deliver)}},[e._v(e._s(t.row.deliver?"已交付":"未交付"))])]}}])})],1)],1)},staticRenderFns:[]},c=n("vSla")(i,l,!1,null,null,null);t.default=c.exports},liLe:function(e,t,n){e.exports={default:n("JhHb"),__esModule:!0}}});